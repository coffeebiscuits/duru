<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì±„ê¶Œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <link href="https://fonts.googleapis.com/css2?family=Spoqa+Han+Sans+Neo:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* ====== ê¸°ë³¸ í…Œë§ˆ (Dark) ====== */
    :root {
      --bg-color: #1e1e1e;
      --sidebar-bg: #222;
      --card-bg: #232323;
      --border-color: #292929;
      --accent-color: #FEE500;
      --text-main: #fff;
      --text-sub: #bdbdbd;
    }

    body {
      font-family: 'Spoqa Han Sans Neo', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      margin: 0;
      overflow-x: hidden;
    }

    /* Bootstrap Overrides for Dark Theme */
    .modal-content { background-color: var(--card-bg); color: var(--text-main); border: 1px solid var(--border-color); }
    .form-control { background-color: #333; border: 1px solid #444; color: #fff; }
    .form-control:focus { background-color: #333; color: #fff; border-color: var(--accent-color); box-shadow: 0 0 0 0.25rem rgba(254, 229, 0, 0.25); }
    .btn-close { filter: invert(1); }

    /* ====== ë ˆì´ì•„ì›ƒ ====== */
    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 24px; background: var(--card-bg); border-bottom: 1px solid var(--border-color);
      position: sticky; top: 0; z-index: 100;
    }
    .profile-wrap { display: flex; align-items: center; gap: 12px; }
    .profile-name { font-size: 1.1rem; font-weight: 700; color: var(--accent-color); }
    
    .container-flex { display: flex; min-height: calc(100vh - 73px); }

    /* ====== ì‚¬ì´ë“œë°” ====== */
    .sidebar {
      width: 240px; background: var(--sidebar-bg); border-right: 1px solid var(--border-color);
      padding: 24px 0; flex-shrink: 0;
    }
    .sidebar-menu { list-style: none; padding: 0 12px; margin: 0; }
    .sidebar-menu li { margin-bottom: 8px; }
    .sidebar-menu a {
      display: block; padding: 12px 16px; border-radius: 8px;
      color: var(--text-sub); text-decoration: none; font-weight: 500; transition: 0.2s; cursor: pointer;
    }
    .sidebar-menu a:hover, .sidebar-menu a.active {
      background: var(--border-color); color: var(--accent-color); font-weight: 700;
    }

    /* ====== ë©”ì¸ ì½˜í…ì¸  ====== */
    .main { flex: 1; padding: 32px; overflow-y: auto; }
    
    /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .stat-card {
      background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px;
      display: flex; flex-direction: column; gap: 8px; margin-bottom: 24px;
    }
    .stat-title { font-size: 0.95rem; color: var(--text-sub); }
    .stat-value { font-size: 2rem; font-weight: 700; color: #fff; margin: 0; }
    
    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    .content-box { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; margin-top: 24px; }
    .table { color: var(--text-main); margin-bottom: 0; }
    .table th { background: var(--card-bg); color: var(--accent-color); border-bottom: 1px solid var(--border-color); border-top: none; }
    .table td { border-bottom: 1px solid var(--border-color); vertical-align: middle; background: var(--card-bg); color: #fff; }
    .table-hover tbody tr:hover td { background-color: #2a2a2a; }

    /* ë°°ì§€ ë° ë²„íŠ¼ */
    .badge-soft { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
    .status-wait { background: rgba(22, 198, 12, 0.2); color: #16c60c; }
    .status-done { background: rgba(189, 189, 189, 0.2); color: #bdbdbd; }
    
    .btn-primary-custom { background: var(--accent-color); color: #000; font-weight: 700; border: none; }
    .btn-primary-custom:hover { background: #ffe066; color: #000; }

    .input-interest { background: #333; border: 1px solid #444; color: #fff; width: 100%; padding: 4px; text-align: right; border-radius: 4px; }

    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .container-flex { flex-direction: column; }
      .sidebar { width: 100%; padding: 10px 0; overflow-x: auto; display: none; } /* ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” ì²˜ë¦¬ í•„ìš” ì‹œ ìˆ˜ì • */
      .sidebar.open { display: block; }
      .main { padding: 16px; }
      .dashboard-grid { grid-template-columns: 1fr; }
    }
    
    .hamburger { display: none; background: none; border: none; flex-direction: column; justify-content: center; gap: 5px; cursor: pointer; }
    .hamburger span { width: 24px; height: 2px; background: var(--accent-color); }
    @media (max-width: 768px) { .hamburger { display: flex; } }
  </style>
</head>
<body>

  <header class="header">
    <div class="profile-wrap">
      <button class="hamburger" id="hamBtn"><span></span><span></span><span></span></button>
      <span class="profile-name">ì±„ê¶Œê´€ë¦¬</span>
    </div>
    <div style="color: var(--accent-color); font-family: monospace;" id="clock">00:00:00</div>
  </header>

  <div class="container-flex">
    <nav class="sidebar" id="sidebar">
      <ul class="sidebar-menu" id="nav-menu">
        <li><a data-tab="dashboard" class="active">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a></li>
        <li><a data-tab="list">ğŸ“¦ ìì‚° ê´€ë¦¬</a></li>
        <li><a data-tab="interest">ğŸ’³ ì´ì ìˆ˜ì·¨</a></li>
        <li><a data-tab="analytics">ğŸ“ˆ ìˆ˜ìµ í†µê³„</a></li>
      </ul>
    </nav>

    <main class="main" id="render-area">
      </main>
  </div>

  <div class="modal fade" id="addBondModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title" style="color:var(--accent-color); font-weight:700;">ìƒˆ ì±„ê¶Œ ë“±ë¡</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form id="add-bond-form">
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label text-secondary small">ì±„ê¶Œëª…</label>
              <input name="name" required class="form-control" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì 123">
            </div>
            <div class="row mb-3">
              <div class="col">
                <label class="form-label text-secondary small">ê³„ì¢Œëª…</label>
                <input name="account" required class="form-control">
              </div>
              <div class="col">
                <label class="form-label text-secondary small">ì´ìœ¨(%)</label>
                <input name="rate" type="number" step="0.01" required class="form-control">
              </div>
            </div>
            <div class="row mb-3">
              <div class="col">
                <label class="form-label text-secondary small">ë§¤ìˆ˜ì¼</label>
                <input name="buyDate" type="date" required class="form-control">
              </div>
              <div class="col">
                <label class="form-label text-secondary small">ë§Œê¸°ì¼</label>
                <input name="maturityDate" type="date" required class="form-control">
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label text-secondary small">ë§¤ìˆ˜ê¸ˆì•¡(ì›)</label>
              <input name="buyAmount" type="number" required class="form-control">
            </div>
          </div>
          <div class="modal-footer border-0">
            <button type="submit" class="btn btn-primary-custom w-100 py-2 rounded-3">ë“±ë¡ ì™„ë£Œ</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ====== ì‹œê³„ ======
    setInterval(() => {
      const n = new Date();
      document.getElementById('clock').innerText = n.toTimeString().split(' ')[0];
    }, 1000);

    // ====== ì‚¬ì´ë“œë°” í† ê¸€ (ëª¨ë°”ì¼) ======
    document.getElementById('hamBtn').addEventListener('click', () => {
      const sb = document.getElementById('sidebar');
      sb.style.display = sb.style.display === 'block' ? 'none' : 'block';
    });

    // ====== ë°ì´í„° ë° ìƒíƒœ ======
    let bonds = JSON.parse(localStorage.getItem('bond_manager_v5_data')) || [];
    let activeTab = 'dashboard';
    let selectedYear = new Date().getFullYear();
    let currentChart = null;

    const formatKRW = (v) => new Intl.NumberFormat('ko-KR').format(v) + 'ì›';
    const saveData = () => localStorage.setItem('bond_manager_v5_data', JSON.stringify(bonds));

    // ====== ë Œë”ë§ í•¨ìˆ˜ ======
    function render() {
      const area = document.getElementById('render-area');
      area.innerHTML = '';
      
      // íƒ­ í™œì„±í™” ì²˜ë¦¬
      document.querySelectorAll('.sidebar-menu a').forEach(a => {
        a.classList.toggle('active', a.dataset.tab === activeTab);
      });

      if (activeTab === 'dashboard') renderDashboard(area);
      else if (activeTab === 'list') renderList(area);
      else if (activeTab === 'interest') renderInterest(area);
      else if (activeTab === 'analytics') renderAnalytics(area);
    }

    function renderDashboard(container) {
      const activeBonds = bonds.filter(b => b.status === 'active');
      const totalInv = activeBonds.reduce((a, c) => a + Number(c.buyAmount), 0);
      let thisYearIncome = 0;
      bonds.forEach(b => {
        const yData = b.interests?.[new Date().getFullYear()];
        if(yData) Object.values(yData).forEach(v => thisYearIncome += (Number(v)||0));
      });

      container.innerHTML = `
        <h3 class="mb-4" style="font-weight:700;">ì•ˆë…•í•˜ì„¸ìš” ğŸ‘‹ <span style="font-size:0.9rem; color:var(--text-sub); font-weight:400;">ì˜¤ëŠ˜ì˜ íˆ¬ì í˜„í™©ì…ë‹ˆë‹¤.</span></h3>
        <div class="row g-4">
          <div class="col-md-4">
            <div class="stat-card">
              <div class="stat-title">í˜„ì¬ ì´ íˆ¬ì ì›ê¸ˆ</div>
              <div class="stat-value" style="color:#FEE500;">${formatKRW(totalInv)}</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="stat-card">
              <div class="stat-title">${new Date().getFullYear()}ë…„ ì˜ˆìƒ ì´ì</div>
              <div class="stat-value">${formatKRW(thisYearIncome)}</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="stat-card">
              <div class="stat-title">ìš´ìš© ì¢…ëª© ìˆ˜</div>
              <div class="stat-value">${activeBonds.length} ê°œ</div>
            </div>
          </div>
        </div>
        <div class="row mt-4">
           <div class="col-lg-8">
             <div class="content-box">
               <h5 style="color:var(--accent-color); margin-bottom:20px;">ìì‚° ë¹„ì¤‘ (Top 5)</h5>
               <canvas id="dashChart" height="100"></canvas>
             </div>
           </div>
           <div class="col-lg-4">
             <div class="content-box">
               <h5 style="color:var(--accent-color); margin-bottom:20px;">ìµœê·¼ ë“±ë¡ ìì‚°</h5>
               <table class="table table-hover table-borderless text-white">
                 <thead><tr><th>ìì‚°ëª…</th><th>ìƒíƒœ</th></tr></thead>
                 <tbody>
                   ${bonds.slice(-4).reverse().map(b => `
                     <tr>
                       <td>${b.name}</td>
                       <td><span class="badge-soft ${b.status==='active'?'status-wait':'status-done'}">${b.status==='active'?'ë³´ìœ ì¤‘':'ì™„ë£Œ'}</span></td>
                     </tr>
                   `).join('')}
                 </tbody>
               </table>
             </div>
           </div>
        </div>
      `;
      
      const ctx = document.getElementById('dashChart').getContext('2d');
      if(currentChart) currentChart.destroy();
      currentChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: activeBonds.slice(0, 5).map(b => b.name),
          datasets: [{ label: 'íˆ¬ìê¸ˆì•¡', data: activeBonds.slice(0, 5).map(b => b.buyAmount), backgroundColor: '#FEE500', borderRadius: 4 }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, grid: { color: '#333' } }, x: { grid: { display: false } } }
        }
      });
    }

    function renderList(container) {
      container.innerHTML = `
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 style="font-weight:700;">ìì‚° ê´€ë¦¬</h3>
          <button class="btn btn-primary-custom rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#addBondModal">+ ìƒˆ ìì‚° ë“±ë¡</button>
        </div>
        <div class="content-box mt-0">
          <div class="table-responsive">
            <table class="table table-hover text-white">
              <thead><tr><th>ì±„ê¶Œëª…</th><th>ê³„ì¢Œ</th><th>ë§¤ìˆ˜ê¸ˆì•¡</th><th>ì´ìœ¨</th><th>ë§Œê¸°ì¼</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
              <tbody>
                ${bonds.length === 0 ? '<tr><td colspan="7" class="text-center py-4 text-muted">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>' : 
                  bonds.slice().reverse().map(b => `
                  <tr>
                    <td>${b.name}</td>
                    <td class="text-secondary">${b.account}</td>
                    <td>${formatKRW(b.buyAmount)}</td>
                    <td style="color:#FEE500;">${b.rate}%</td>
                    <td class="text-secondary">${b.maturityDate}</td>
                    <td><span class="badge-soft ${b.status==='active'?'status-wait':'status-done'}">${b.status==='active'?'ë³´ìœ ì¤‘':'ì™„ë£Œ'}</span></td>
                    <td>
                      <button onclick="deleteBond(${b.id})" class="btn btn-sm btn-outline-danger border-0">ğŸ—‘ï¸</button>
                      ${b.status==='active' ? `<button onclick="toggleStatus(${b.id})" class="btn btn-sm btn-outline-success border-0">âœ”ï¸</button>` : ''}
                    </td>
                  </tr>`).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    function renderInterest(container) {
      container.innerHTML = `
        <h3 class="mb-4" style="font-weight:700;">ì´ì ìˆ˜ì·¨ ê´€ë¦¬</h3>
        <div class="content-box mt-0">
          <div class="mb-3">
             <select onchange="changeYear(this.value)" class="form-select w-auto bg-dark text-white border-secondary">
               ${[2024, 2025, 2026, 2027, 2028].map(y => `<option value="${y}" ${selectedYear==y?'selected':''}>${y}ë…„</option>`).join('')}
             </select>
          </div>
          <div class="table-responsive">
            <table class="table table-bordered text-center text-white" style="border-color:#333;">
              <thead>
                <tr>
                  <th class="text-start">ìì‚°ëª…</th>
                  <th>í•©ê³„</th>
                  ${Array.from({length:12}, (_,i)=>`<th>${i+1}ì›”</th>`).join('')}
                </tr>
              </thead>
              <tbody>
                ${bonds.map(b => {
                  const yData = b.interests?.[selectedYear] || {};
                  const rowTotal = Object.values(yData).reduce((a,v)=>a+(Number(v)||0), 0);
                  return `
                    <tr>
                      <td class="text-start">${b.name}</td>
                      <td style="color:#FEE500;">${rowTotal.toLocaleString()}</td>
                      ${Array.from({length:12}, (_,i)=>`
                        <td><input type="number" value="${yData[i+1]||''}" onchange="updateInterest(${b.id}, ${selectedYear}, ${i+1}, this.value)" class="input-interest"></td>
                      `).join('')}
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    function renderAnalytics(container) {
      const totalLife = bonds.reduce((a, c) => a + Number(c.buyAmount), 0);
      let totalProfit = 0;
      bonds.forEach(b => Object.values(b.interests || {}).forEach(y => Object.values(y).forEach(v => totalProfit += (Number(v)||0))));
      const monthlyData = Array(12).fill(0).map((_, i) => {
        let sum = 0;
        bonds.forEach(b => sum += (Number(b.interests?.[selectedYear]?.[i+1]) || 0));
        return sum;
      });

      container.innerHTML = `
        <h3 class="mb-4" style="font-weight:700;">ìˆ˜ìµ í†µê³„</h3>
        <div class="row g-4">
          <div class="col-md-6">
            <div class="stat-card">
              <div class="stat-title">ëˆ„ì  ì´ íˆ¬ìì•¡</div>
              <div class="stat-value">${formatKRW(totalLife)}</div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="stat-card">
              <div class="stat-title">ëˆ„ì  ì´ì ìˆ˜ìµ</div>
              <div class="stat-value" style="color:#16c60c;">+${formatKRW(totalProfit)}</div>
            </div>
          </div>
        </div>
        <div class="content-box">
          <h5 style="color:var(--accent-color);">${selectedYear}ë…„ ì›”ë³„ ìˆ˜ìµ ì¶”ì´</h5>
          <canvas id="anaChart" height="100"></canvas>
        </div>
      `;
      
      const ctx = document.getElementById('anaChart').getContext('2d');
      if(currentChart) currentChart.destroy();
      currentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({length:12}, (_,i)=>`${i+1}ì›”`),
          datasets: [{
            label: 'ì›”ë³„ ìˆ˜ìµ', data: monthlyData, borderColor: '#FEE500', backgroundColor: 'rgba(254, 229, 0, 0.1)',
            fill: true, tension: 0.4
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, grid: { color: '#333' } }, x: { grid: { color: '#333' } } }
        }
      });
    }

    // ====== ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ======
    document.getElementById('nav-menu').addEventListener('click', (e) => {
      const target = e.target.closest('a'); // a íƒœê·¸ ê°ì§€
      if (target && target.dataset.tab) {
        activeTab = target.dataset.tab;
        render();
      }
    });

    document.getElementById('add-bond-form').onsubmit = (e) => {
      e.preventDefault();
      const fd = new FormData(e.target);
      bonds.push({
        id: Date.now(),
        name: fd.get('name'), account: fd.get('account'),
        buyDate: fd.get('buyDate'), maturityDate: fd.get('maturityDate'),
        rate: fd.get('rate'), buyAmount: Number(fd.get('buyAmount')),
        status: 'active', interests: {}
      });
      saveData();
      bootstrap.Modal.getInstance(document.getElementById('addBondModal')).hide();
      e.target.reset();
      render();
    };

    window.toggleStatus = (id) => {
      bonds = bonds.map(b => b.id === id ? {...b, status: 'completed'} : b);
      saveData(); render();
    };
    window.deleteBond = (id) => {
      if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { bonds = bonds.filter(b => b.id !== id); saveData(); render(); }
    };
    window.updateInterest = (id, y, m, v) => {
      bonds = bonds.map(b => {
        if(b.id === id) {
          if(!b.interests) b.interests = {};
          if(!b.interests[y]) b.interests[y] = {};
          b.interests[y][m] = v;
        }
        return b;
      });
      saveData(); render();
    };
    window.changeYear = (v) => { selectedYear = v; render(); };

    // ì´ˆê¸° ë Œë”ë§
    render();
  </script>
</body>
</html>
